<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.inventory.Calo.s_Drugstore.controller.ReportsController"
            styleClass="reports-root">

    <fx:define>
        <ToggleGroup fx:id="timePeriodToggle"/>
    </fx:define>

    <!-- Sidebar -->
    <left>
        <VBox fx:id="sidebar" styleClass="sidebar-overlay" prefWidth="250" minWidth="70">
            <padding>
                <Insets top="20" bottom="20"/>
            </padding>

            <HBox styleClass="sidebar-header" alignment="CENTER_LEFT" spacing="15">
                <padding>
                    <Insets top="10" right="20" bottom="10" left="20"/>
                </padding>

                <StackPane styleClass="sidebar-logo">
                    <Label text="ðŸ’Š" styleClass="sidebar-logo-icon"/>
                </StackPane>
                <Label text="PharmaTrack" styleClass="sidebar-title"/>
            </HBox>

            <Separator styleClass="sidebar-separator"/>

            <VBox spacing="5" styleClass="sidebar-menu" VBox.vgrow="ALWAYS">
                <padding>
                    <Insets top="10" right="10" bottom="10" left="10"/>
                </padding>

                <Button fx:id="dashboardBtn" text="ðŸ“Š  Dashboard" styleClass="menu-item"
                        onAction="#handleDashboard"/>

                <!-- Do the same for all buttons: -->
                <Button fx:id="inventoryBtn" text="ðŸ“¦  Inventory" styleClass="menu-item"
                        onAction="#handleInventory"/>

                <Button fx:id="salesBtn" text="ðŸ›’  Sales" styleClass="menu-item"
                        onAction="#handleSales"/>

                <Button fx:id="reportsBtn" text="ðŸ“ˆ  Reports" styleClass="menu-item"
                        onAction="#handleReports"/>

                <Button fx:id="staffBtn" text="ðŸ‘¥  Staff" styleClass="menu-item"
                        onAction="#handleStaff"/>
            </VBox>

            <Separator styleClass="sidebar-separator"/>

            <VBox styleClass="sidebar-user" spacing="5">
                <padding>
                    <Insets top="15" right="20" bottom="15" left="20"/>
                </padding>

                <HBox alignment="CENTER_LEFT" spacing="10">
                    <StackPane styleClass="user-avatar">
                        <Label text="ðŸ‘¤" styleClass="user-avatar-icon"/>
                    </StackPane>
                    <VBox spacing="2">
                        <Label fx:id="userNameLabel" text="Admin User" styleClass="user-name"/>
                        <Label fx:id="userEmailLabel" text="admin@pharmatrack.com" styleClass="user-email"/>
                    </VBox>
                </HBox>
            </VBox>

            <Separator styleClass="sidebar-separator"/>

            <Button fx:id="logoutBtn" text="Logout" styleClass="logout-btn"
                    onAction="#handleLogout">
                <graphic>
                    <Label text="ðŸšª" styleClass="menu-icon"/>
                </graphic>
            </Button>

        </VBox>
    </left>

    <!-- Main Content -->
    <center>
        <VBox styleClass="main-content" spacing="25">
            <!-- Header -->
            <HBox alignment="CENTER_LEFT" styleClass="page-header">
                <VBox VBox.vgrow="ALWAYS">
                    <Label text="Reports &amp; Analytics" styleClass="page-title"/>
                    <Label text="Comprehensive insights into your pharmacy operations" styleClass="page-subtitle"/>
                </VBox>
<!--                <Button text="ðŸ“¥ Export Report" styleClass="export-button" onAction="#handleExportReport"/>-->
            </HBox>

            <ScrollPane fitToWidth="true" styleClass="scroll-pane">
                <VBox spacing="25" style="-fx-padding: 0 20 20 0;">
                    <!-- Sales Trends Chart -->
                    <VBox styleClass="filter-card">
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <Label text="ðŸ“ˆ" style="-fx-font-size: 24px;"/>
                            <VBox>
                                <Label text="Sales Trends" styleClass="filter-title"/>
                                <Label text="Sales performance over different time periods" styleClass="filter-subtitle"/>
                            </VBox>
                            <Region HBox.hgrow="ALWAYS"/>
                            <ToggleButton text="Daily" toggleGroup="$timePeriodToggle" styleClass="period-toggle" selected="true" onAction="#handleDailyView"/>
                            <ToggleButton text="Weekly" toggleGroup="$timePeriodToggle" styleClass="period-toggle" onAction="#handleWeeklyView"/>
                            <ToggleButton text="Monthly" toggleGroup="$timePeriodToggle" styleClass="period-toggle" onAction="#handleMonthlyView"/>
                        </HBox>

                        <StackPane fx:id="salesChartContainer" prefHeight="350" style="-fx-padding: 20 0 0 0;"/>
                    </VBox>

                    <!-- Top Selling Medicines -->
                    <VBox styleClass="filter-card">
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <Label text="ðŸ›’" style="-fx-font-size: 24px;"/>
                            <VBox>
                                <Label text="Top Selling Medicines" styleClass="filter-title"/>
                                <Label text="Most popular items this week" styleClass="filter-subtitle"/>
                            </VBox>
                        </HBox>

                        <TableView fx:id="topSellingTable" prefHeight="350" style="-fx-padding: 20 0 0 0;">
                            <columns>
                                <TableColumn fx:id="rankCol" text="Rank" prefWidth="100"/>
                                <TableColumn fx:id="topMedicineNameCol" text="Medicine" prefWidth="300"/>
                                <TableColumn fx:id="categoryCol" text="Category" prefWidth="200"/>
                                <TableColumn fx:id="quantitySoldCol" text="Quantity" prefWidth="150"/>
                            </columns>
                        </TableView>
                    </VBox>

                    <!-- Two Column Layout -->
                    <HBox spacing="25">
                        <!-- Sales by Category -->
                        <VBox styleClass="filter-card" HBox.hgrow="ALWAYS">
                            <HBox alignment="CENTER_LEFT" spacing="15">
                                <Label text="ðŸ’°" style="-fx-font-size: 24px;"/>
                                <VBox>
                                    <Label text="Sales by Category" styleClass="filter-title"/>
                                    <Label text="Distribution of sales across medicine categories" styleClass="filter-subtitle"/>
                                </VBox>
                            </HBox>
                            <StackPane fx:id="categoryChartContainer" prefHeight="300" style="-fx-padding: 20 0 0 0;"/>
                        </VBox>

                        <!-- Key Performance Indicators -->
                        <VBox styleClass="filter-card" prefWidth="400">
                            <Label text="Key Performance Indicators" styleClass="filter-title"/>
                            <Label text="Important metrics for this month" styleClass="filter-subtitle" style="-fx-padding: 0 0 15 0;"/>

                            <VBox spacing="12">
                                <HBox styleClass="kpi-card, revenue" alignment="CENTER_LEFT">
                                    <VBox HBox.hgrow="ALWAYS">
                                        <Label text="Total Revenue" styleClass="kpi-title"/>
                                        <Label fx:id="totalRevenueLabel" text="â‚±75,420" styleClass="kpi-value"/>
                                    </VBox>
                                    <Label text="ðŸ“ˆ" style="-fx-font-size: 32px;"/>
                                </HBox>

                                <HBox styleClass="kpi-card, transactions" alignment="CENTER_LEFT">
                                    <VBox HBox.hgrow="ALWAYS">
                                        <Label text="Total Transactions" styleClass="kpi-title"/>
                                        <Label fx:id="totalTransactionsLabel" text="1,247" styleClass="kpi-value"/>
                                    </VBox>
                                    <Label text="ðŸ“…" style="-fx-font-size: 32px;"/>
                                </HBox>

                                <HBox styleClass="kpi-card, average" alignment="CENTER_LEFT">
                                    <VBox HBox.hgrow="ALWAYS">
                                        <Label text="Average Order Value" styleClass="kpi-title"/>
                                        <Label fx:id="avgOrderValueLabel" text="â‚±60.50" styleClass="kpi-value"/>
                                    </VBox>
                                    <Label text="ðŸ’µ" style="-fx-font-size: 32px;"/>
                                </HBox>

                                <HBox styleClass="kpi-card, stock" alignment="CENTER_LEFT">
                                    <VBox HBox.hgrow="ALWAYS">
                                        <Label text="Low Stock Items" styleClass="kpi-title"/>
                                        <Label fx:id="lowStockItemsLabel" text="8" styleClass="kpi-value"/>
                                    </VBox>
                                    <Label text="âš " style="-fx-font-size: 32px;"/>
                                </HBox>
                            </VBox>
                        </VBox>

                    </HBox>

                    <!-- Transaction Management (Admin Only) -->
                    <VBox styleClass="filter-card">
                        <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-padding: 0 0 15 0;">
                            <Label text="ðŸ“" style="-fx-font-size: 24px;"/>
                            <VBox>
                                <Label text="Transaction Management" styleClass="filter-title"/>
                                <Label text="View and manage all sales transactions" styleClass="filter-subtitle"/>
                            </VBox>
                            <Region HBox.hgrow="ALWAYS"/>
                        <!--<Button fx:id="refreshTransactionsBtn" text="ðŸ”„ Refresh" styleClass="refresh-button" onAction="#handleRefreshTransactions"/> -->
                    </HBox>

                    <TableView fx:id="transactionsTable" prefHeight="400" styleClass="transactions-table">
                        <columns>
                            <TableColumn fx:id="txnIdCol" text="Transaction ID" prefWidth="120" styleClass="transactions-table"/>
                            <TableColumn fx:id="txnDateCol" text="Date &amp; Time" prefWidth="200" styleClass="transactions-table"/>
                            <TableColumn fx:id="txnItemsCol" text="Items" prefWidth="100" styleClass="transactions-table"/>
                            <TableColumn fx:id="txnTotalCol" text="Total Amount" prefWidth="130" styleClass="transactions-table"/>
                            <TableColumn fx:id="txnStaffCol" text="Staff" prefWidth="180" styleClass="transactions-table"/>
                            <TableColumn fx:id="txnActionsCol" text="Actions" prefWidth="220" styleClass="transactions-table"/>
                        </columns>
                    </TableView>
                </VBox>

                <!-- Expiring Medicines Alert -->
                    <VBox styleClass="filter-card">
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <Label text="âš " style="-fx-font-size: 24px;"/>
                            <VBox>
                                <Label text="Expiring Medicines Alert" styleClass="filter-title"/>
                                <Label text="Medicines expiring within 30 days or already expired" styleClass="filter-subtitle"/>
                            </VBox>
                        </HBox>

                        <TableView fx:id="expiringMedicinesTable" styleClass="">
                            <columns>
                                <TableColumn fx:id="medicineIdCol" text="Medicine ID" prefWidth="120"/>
                                <TableColumn fx:id="medicineNameCol" text="Medicine Name" prefWidth="250"/>
                                <TableColumn fx:id="expirationDateCol" text="Expiration Date" prefWidth="150"/>
                                <TableColumn fx:id="daysLeftCol" text="Days Left" prefWidth="150"/>
                                <TableColumn fx:id="stockCol" text="Stock" prefWidth="100"/>
                                <TableColumn fx:id="statusCol" text="Status" prefWidth="120"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </ScrollPane>
        </VBox>
    </center>
</BorderPane>